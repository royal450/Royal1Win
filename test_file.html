<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinGo Admin Panel - R-WIN</title>
    <link rel="stylesheet" href="admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">


<style>
    
    /* admin.css - Complete Admin Panel Styling */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Orbitron', monospace;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #333;
    min-height: 100vh;
    overflow-x: hidden;
}

.admin-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    min-height: 100vh;
}

/* ======== HEADER ======== */
.admin-header {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 20px 30px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    backdrop-filter: blur(10px);
}

.admin-title {
    font-size: 2.5rem;
    font-weight: 900;
    background: linear-gradient(45deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.admin-status {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 5px;
}

.status-indicator {
    font-size: 1.2rem;
    font-weight: bold;
    padding: 8px 15px;
    border-radius: 25px;
    background: rgba(0, 0, 0, 0.1);
}

.admin-time {
    font-size: 1.1rem;
    color: #666;
    font-weight: 400;
}

/* ======== DASHBOARD GRID ======== */
.admin-dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

/* ======== ADMIN CARDS ======== */
.admin-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.admin-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
}

.admin-card h2 {
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: #333;
    border-bottom: 2px solid #667eea;
    padding-bottom: 10px;
}

/* ======== PERIOD CARD ======== */
.period-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.period-info {
    text-align: center;
    margin-top: 20px;
}

.period-number {
    font-size: 2.5rem;
    font-weight: 900;
    margin-bottom: 10px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
}

.period-timer {
    font-size: 1.8rem;
    font-weight: 700;
    background: rgba(255, 255, 255, 0.2);
    padding: 10px 20px;
    border-radius: 25px;
    display: inline-block;
}

/* ======== STATISTICS ======== */
.total-stats {
    display: flex;
    justify-content: space-between;
    margin-bottom: 25px;
    gap: 15px;
}

.stat-item {
    text-align: center;
    padding: 15px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border-radius: 10px;
    flex: 1;
}

.stat-label {
    display: block;
    font-size: 0.9rem;
    color: #666;
    margin-bottom: 5px;
}

.stat-value {
    display: block;
    font-size: 1.8rem;
    font-weight: 900;
    color: #333;
}

/* ======== BETTING DISTRIBUTION ======== */
.betting-distribution {
    margin-bottom: 25px;
}

.betting-distribution h3 {
    font-size: 1.2rem;
    margin-bottom: 15px;
    color: #555;
}

/* Number Stats */
.number-stats {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
    margin-bottom: 20px;
}

.number-stat {
    text-align: center;
    padding: 15px 8px;
    border-radius: 10px;
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    transition: transform 0.2s ease;
}

.number-stat:hover {
    transform: scale(1.05);
}

.number-stat .number {
    display: block;
    font-size: 1.5rem;
    font-weight: 900;
    color: #333;
    margin-bottom: 5px;
}

.number-stat .amount {
    display: block;
    font-size: 1rem;
    font-weight: 700;
    color: #667eea;
    margin-bottom: 3px;
}

.number-stat .count {
    display: block;
    font-size: 0.8rem;
    color: #666;
}

/* Color Stats */
.color-stats {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.color-stat {
    flex: 1;
    text-align: center;
    padding: 15px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.05);
}

.color-indicator {
    display: inline-block;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    margin-bottom: 10px;
}

.color-indicator.red { background: #e74c3c; }
.color-indicator.green { background: #27ae60; }
.color-indicator.violet { background: #9b59b6; }

.color-name {
    display: block;
    font-weight: 700;
    margin-bottom: 5px;
}

/* Size Stats */
.size-stats {
    display: flex;
    gap: 15px;
}

.size-stat {
    flex: 1;
    text-align: center;
    padding: 15px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.05);
}

.size-name {
    display: block;
    font-weight: 700;
    margin-bottom: 5px;
}

/* ======== ADMIN CONTROLS ======== */
.controls-card {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
}

.override-warning {
    background: rgba(255, 0, 0, 0.1);
    border: 2px solid #e74c3c;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
    text-align: center;
    font-weight: 700;
    color: #c0392b;
}

.override-controls {
    margin-bottom: 20px;
}

.control-group {
    margin-bottom: 15px;
}

.control-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 700;
    color: #333;
}

.admin-select {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #ddd;
    border-radius: 10px;
    font-size: 1rem;
    font-family: 'Orbitron', monospace;
    background: white;
    transition: border-color 0.3s ease;
}

.admin-select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
}

.control-buttons {
    display: flex;
    gap: 15px;
    margin-top: 20px;
}

.btn-override, .btn-clear {
    flex: 1;
    padding: 15px 20px;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: 900;
    font-family: 'Orbitron', monospace;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-override {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    color: white;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.btn-override:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(255, 107, 107, 0.4);
}

.btn-clear {
    background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    color: white;
}

.btn-clear:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(116, 185, 255, 0.4);
}

.override-status {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    font-weight: 700;
}

/* ======== USERS CARD ======== */
.users-list {
    max-height: 300px;
    overflow-y: auto;
    padding-right: 10px;
}

.user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    margin-bottom: 10px;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 10px;
    transition: background 0.3s ease;
}

.user-item:hover {
    background: rgba(0, 0, 0, 0.1);
}

.user-info {
    display: flex;
    flex-direction: column;
}

.user-id {
    font-weight: 700;
    font-size: 0.9rem;
}

.user-activity {
    font-size: 0.8rem;
    color: #666;
}

.user-bets {
    text-align: right;
    font-weight: 700;
    color: #667eea;
}

.no-users {
    text-align: center;
    color: #999;
    font-style: italic;
    padding: 30px;
}

/* ======== RESULTS CARD ======== */
.results-list {
    max-height: 300px;
    overflow-y: auto;
}

.result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    margin-bottom: 10px;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 10px;
    border-left: 4px solid #667eea;
}

.result-period {
    font-weight: 700;
    font-size: 0.9rem;
}

.result-values {
    display: flex;
    gap: 10px;
    align-items: center;
}

.result-number {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #667eea;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
}

.result-color {
    padding: 5px 10px;
    border-radius: 15px;
    color: white;
    font-size: 0.8rem;
    font-weight: 700;
}

.result-color.red { background: #e74c3c; }
.result-color.green { background: #27ae60; }
.result-color.violet { background: #9b59b6; }

.result-size {
    padding: 5px 10px;
    border-radius: 15px;
    background: #95a5a6;
    color: white;
    font-size: 0.8rem;
    font-weight: 700;
}

.no-results {
    text-align: center;
    color: #999;
    font-style: italic;
    padding: 30px;
}

/* ======== HEALTH CARD ======== */
.health-stats {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.health-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    background: rgba(0, 0, 0, 0.05);
    border-radius: 10px;
}

.health-label {
    font-weight: 700;
}

.health-value {
    font-weight: 900;
    color: #667eea;
}

/* ======== FOOTER ======== */
.admin-footer {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    color: #666;
    backdrop-filter: blur(10px);
}

/* ======== TOAST NOTIFICATION ======== */
.admin-toast {
    position: fixed;
    top: 30px;
    right: 30px;
    padding: 15px 25px;
    border-radius: 10px;
    color: white;
    font-weight: 700;
    z-index: 10000;
    transform: translateX(150%);
    transition: transform 0.3s ease-out;
    max-width: 400px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.admin-toast.show {
    transform: translateX(0);
}

.admin-toast.success {
    background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
}

.admin-toast.error {
    background: linear-gradient(135deg, #e17055 0%, #d63031 100%);
}

.admin-toast.warning {
    background: linear-gradient(135deg, #fdcb6e 0%, #e84393 100%);
}

/* ======== SCROLLBAR STYLING ======== */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
}

/* ======== RESPONSIVE DESIGN ======== */
@media (max-width: 768px) {
    .admin-container {
        padding: 15px;
    }
    
    .admin-header {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }
    
    .admin-title {
        font-size: 2rem;
    }
    
    .admin-dashboard {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .total-stats {
        flex-direction: column;
        gap: 10px;
    }
    
    .number-stats {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .control-buttons {
        flex-direction: column;
    }
    
    .color-stats, .size-stats {
        flex-direction: column;
        gap: 10px;
    }
}

@media (max-width: 480px) {
    .admin-card {
        padding: 20px;
    }
    
    .admin-title {
        font-size: 1.5rem;
    }
    
    .period-number {
        font-size: 2rem;
    }
    
    .period-timer {
        font-size: 1.5rem;
    }
    
    .number-stats {
        grid-template-columns: repeat(2, 1fr);
    }
}

/* ======== ANIMATIONS ======== */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.admin-card {
    animation: fadeInUp 0.6s ease-out;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.status-indicator {
    animation: pulse 2s infinite;
}

/* ======== LOADING STATES ======== */
.loading {
    position: relative;
    overflow: hidden;
}

.loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% { left: -100%; }
    100% { left: 100%; }
}
    
    
    
</style>

</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <h1 class="admin-title">🎮 WinGo Admin Panel</h1>
            <div class="admin-status">
                <span class="status-indicator" id="connectionStatus">🔴 Connecting...</span>
                <span class="admin-time" id="currentTime"></span>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="admin-dashboard">
            
            <!-- Current Period Info -->
            <div class="admin-card period-card">
                <h2>📊 Current Period</h2>
                <div class="period-info">
                    <div class="period-number" id="currentPeriod">Loading...</div>
                    <div class="period-timer" id="periodTimer">00:00</div>
                </div>
            </div>

            <!-- Live Statistics -->
            <div class="admin-card stats-card">
                <h2>📈 Live Betting Statistics</h2>
                
                <!-- Total Stats -->
                <div class="total-stats">
                    <div class="stat-item">
                        <span class="stat-label">Active Users:</span>
                        <span class="stat-value" id="activeUsers">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Bets:</span>
                        <span class="stat-value" id="totalBets">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Amount:</span>
                        <span class="stat-value" id="totalAmount">₹0</span>
                    </div>
                </div>

                <!-- Number Distribution -->
                <div class="betting-distribution">
                    <h3>🔢 Number Distribution</h3>
                    <div class="number-stats" id="numberStats">
                        <div class="number-stat" data-number="0">
                            <span class="number">0</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="1">
                            <span class="number">1</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="2">
                            <span class="number">2</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="3">
                            <span class="number">3</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="4">
                            <span class="number">4</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="5">
                            <span class="number">5</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="6">
                            <span class="number">6</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="7">
                            <span class="number">7</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="8">
                            <span class="number">8</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="number-stat" data-number="9">
                            <span class="number">9</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                    </div>
                </div>

                <!-- Color Distribution -->
                <div class="betting-distribution">
                    <h3>🎨 Color Distribution</h3>
                    <div class="color-stats" id="colorStats">
                        <div class="color-stat" data-color="red">
                            <span class="color-indicator red"></span>
                            <span class="color-name">Red</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="color-stat" data-color="green">
                            <span class="color-indicator green"></span>
                            <span class="color-name">Green</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="color-stat" data-color="violet">
                            <span class="color-indicator violet"></span>
                            <span class="color-name">Violet</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                    </div>
                </div>

                <!-- Size Distribution -->
                <div class="betting-distribution">
                    <h3>📏 Size Distribution</h3>
                    <div class="size-stats" id="sizeStats">
                        <div class="size-stat" data-size="big">
                            <span class="size-name">Big</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                        <div class="size-stat" data-size="small">
                            <span class="size-name">Small</span>
                            <span class="amount">₹0</span>
                            <span class="count">(0 bets)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Controls -->
            <div class="admin-card controls-card">
                <h2>👑 Admin Result Override</h2>
                <div class="override-warning">
                    ⚠️ Admin result has 100% priority over automatic generation
                </div>
                
                <div class="override-controls">
                    <div class="control-group">
                        <label>Winning Number:</label>
                        <select id="adminNumber" class="admin-select">
                            <option value="">Auto Generate</option>
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label>Winning Color:</label>
                        <select id="adminColor" class="admin-select">
                            <option value="">Auto Generate</option>
                            <option value="red">Red</option>
                            <option value="green">Green</option>
                            <option value="violet">Violet</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label>Winning Size:</label>
                        <select id="adminSize" class="admin-select">
                            <option value="">Auto Generate</option>
                            <option value="big">Big</option>
                            <option value="small">Small</option>
                        </select>
                    </div>

                    <div class="control-buttons">
                        <button class="btn-override" onclick="setAdminResult()">
                            🚨 OVERRIDE RESULT
                        </button>
                        <button class="btn-clear" onclick="clearAdminResult()">
                            🔄 CLEAR OVERRIDE
                        </button>
                    </div>
                </div>

                <!-- Override Status -->
                <div class="override-status" id="overrideStatus">
                    <span class="status-text">No override set - using automatic generation</span>
                </div>
            </div>

            <!-- Active Users -->
            <div class="admin-card users-card">
                <h2>👥 Live User Activity</h2>
                <div class="users-list" id="usersList">
                    <div class="no-users">No active users</div>
                </div>
            </div>

            <!-- Recent Results -->
            <div class="admin-card results-card">
                <h2>📊 Recent Results</h2>
                <div class="results-list" id="recentResults">
                    <div class="no-results">No results yet</div>
                </div>
            </div>

            <!-- System Health -->
            <div class="admin-card health-card">
                <h2>🔧 System Health</h2>
                <div class="health-stats">
                    <div class="health-item">
                        <span class="health-label">Primary Clients:</span>
                        <span class="health-value" id="primaryClients">0</span>
                    </div>
                    <div class="health-item">
                        <span class="health-label">Active Clients:</span>
                        <span class="health-value" id="activeClients">0</span>
                    </div>
                    <div class="health-item">
                        <span class="health-label">System Status:</span>
                        <span class="health-value" id="systemStatus">🟡 Checking...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="admin-footer">
            <p>&copy; 2025 R-WIN Admin Panel | Last Updated: <span id="lastUpdate">Never</span></p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="admin-toast" id="adminToast"></div>

    <!-- Firebase and Admin Script -->
    <script type="module">
        
        
        
    // admin.js - Complete Admin Panel Logic

// ======== FIREBASE CONFIGURATION ========
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
import { getDatabase, ref, set, get, onValue, update, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';

// Firebase configuration (same as main app)
const firebaseConfig = {
  apiKey: "AIzaSyBuioOF7DCq-qIoa1D6ZyZbrAVeGjbfv3Y",
  authDomain: "daily-campaign-king.firebaseapp.com",
  databaseURL: "https://daily-campaign-king-default-rtdb.firebaseio.com",
  projectId: "daily-campaign-king",
  storageBucket: "daily-campaign-king.appspot.com",
  messagingSenderId: "1089692268059",
  appId: "1:1089692268059:web:eddde94901436202576abe",
  measurementId: "G-6PXV3B5322"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ======== ADMIN GLOBAL VARIABLES ========
let currentPeriod = null;
let periodTimer = 0;
let adminTimerInterval = null;
let connectionStatus = false;
let currentBettingStats = {
  numbers: {},
  colors: {},
  sizes: {},
  totalUsers: 0,
  totalBets: 0,
  totalAmount: 0
};
let activeUsers = {};
let recentResults = [];
let systemHealth = {
  primaryClients: 0,
  activeClients: 0,
  status: 'checking'
};

// ======== UTILITY FUNCTIONS ========
function formatIndianNumber(num) {
  return new Intl.NumberFormat('en-IN').format(num);
}

function formatTime(seconds) {
  const mins = Math.floor(seconds / 60);
  const secs = seconds % 60;
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

function capitalizeFirstLetter(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}

// ======== TOAST NOTIFICATION SYSTEM ========
function showAdminToast(message, type = 'success') {
  try {
    const toast = document.getElementById('adminToast');
    if (!toast) return;

    // Remove existing classes
    toast.classList.remove('show', 'success', 'error', 'warning');
    
    // Set message and type
    toast.textContent = message;
    toast.classList.add(type);
    
    // Show toast
    setTimeout(() => {
      toast.classList.add('show');
    }, 10);
    
    // Hide after 4 seconds
    setTimeout(() => {
      toast.classList.remove('show');
    }, 4000);
    
  } catch (error) {
    console.error("❌ Error showing admin toast:", error);
  }
}

// ======== REAL-TIME CLOCK ========
function updateAdminClock() {
  try {
    const now = new Date();
    const timeString = now.toLocaleString('en-IN', {
      timeZone: 'Asia/Kolkata',
      hour12: true,
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
    
    const timeElement = document.getElementById('currentTime');
    if (timeElement) {
      timeElement.textContent = timeString;
    }
    
    // Update last update time
    const lastUpdateElement = document.getElementById('lastUpdate');
    if (lastUpdateElement) {
      lastUpdateElement.textContent = now.toLocaleTimeString('en-IN', { hour12: true });
    }
  } catch (error) {
    console.error("❌ Error updating admin clock:", error);
  }
}

// ======== PERIOD MONITORING ========
function setupPeriodMonitoring() {
  try {
    console.log("📊 Setting up period monitoring...");
    
    const periodRef = ref(db, 'gameSystem/currentPeriod');
    
    onValue(periodRef, (snapshot) => {
      if (snapshot.exists()) {
        const newPeriod = snapshot.val();
        
        if (newPeriod !== currentPeriod) {
          console.log("🔄 Period changed:", currentPeriod, "→", newPeriod);
          currentPeriod = newPeriod;
          updatePeriodDisplay();
          loadBettingStatistics();
          checkAdminOverride();
        }
      }
    }, (error) => {
      console.error("❌ Error in period monitoring:", error);
      updateConnectionStatus(false);
    });
    
    console.log("✅ Period monitoring setup complete");
  } catch (error) {
    console.error("❌ Error setting up period monitoring:", error);
  }
}

function updatePeriodDisplay() {
  try {
    const periodElement = document.getElementById('currentPeriod');
    if (periodElement && currentPeriod) {
      periodElement.textContent = currentPeriod;
    }
  } catch (error) {
    console.error("❌ Error updating period display:", error);
  }
}

// ======== TIMER SYNCHRONIZATION ========
function setupAdminTimer() {
  try {
    console.log("⏰ Setting up admin timer...");
    
    adminTimerInterval = setInterval(() => {
      updateTimerDisplay();
    }, 1000);
    
    console.log("✅ Admin timer started");
  } catch (error) {
    console.error("❌ Error setting up admin timer:", error);
  }
}

function updateTimerDisplay() {
  try {
    const now = Date.now();
    const minuteInMs = 60 * 1000;
    
    const currentCycleStart = Math.floor(now / minuteInMs) * minuteInMs;
    const elapsed = now - currentCycleStart;
    const remaining = Math.ceil((minuteInMs - elapsed) / 1000);
    
    const displayTime = Math.max(0, Math.min(60, remaining));
    
    const timerElement = document.getElementById('periodTimer');
    if (timerElement) {
      timerElement.textContent = formatTime(displayTime);
    }
  } catch (error) {
    console.error("❌ Error updating timer display:", error);
  }
}

// ======== BETTING STATISTICS ========
function setupBettingStatsMonitoring() {
  try {
    console.log("📈 Setting up betting stats monitoring...");
    
    // Monitor current period bets
    const setupBetsListener = () => {
      if (!currentPeriod) return;
      
      const betsRef = ref(db, `CurrentGameBets/${currentPeriod}`);
      
      onValue(betsRef, (snapshot) => {
        if (snapshot.exists()) {
          const betsData = snapshot.val();
          calculateBettingStatistics(betsData);
          updateStatisticsDisplay();
          updateActiveUsers(betsData);
        } else {
          resetStatistics();
        }
      }, (error) => {
        console.error("❌ Error monitoring betting stats:", error);
      });
    };
    
    // Set up listener when period changes
    if (currentPeriod) {
      setupBetsListener();
    }
    
    // Re-setup when period changes
    const periodRef = ref(db, 'gameSystem/currentPeriod');
    onValue(periodRef, setupBetsListener);
    
    console.log("✅ Betting stats monitoring setup complete");
  } catch (error) {
    console.error("❌ Error setting up betting stats monitoring:", error);
  }
}

function calculateBettingStatistics(betsData) {
  try {
    // Reset stats
    currentBettingStats = {
      numbers: { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 },
      colors: { red: 0, green: 0, violet: 0 },
      sizes: { big: 0, small: 0 },
      totalUsers: 0,
      totalBets: 0,
      totalAmount: 0,
      numberCounts: { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 },
      colorCounts: { red: 0, green: 0, violet: 0 },
      sizeCounts: { big: 0, small: 0 }
    };
    
    let userCount = 0;
    
    for (const userId in betsData) {
      userCount++;
      const userBets = betsData[userId];
      
      for (const betId in userBets) {
        const bet = userBets[betId];
        const amount = parseFloat(bet.user_total_amount) || 0;
        
        currentBettingStats.totalBets++;
        currentBettingStats.totalAmount += amount;
        
        // Number bets
        if (bet.bet_type === 'number' && bet.user_selected_numbers !== undefined) {
          const number = parseInt(bet.user_selected_numbers);
          if (number >= 0 && number <= 9) {
            currentBettingStats.numbers[number] += amount;
            currentBettingStats.numberCounts[number]++;
          }
        }
        
        // Color bets
        if (bet.bet_type === 'color' && bet.user_selected_color) {
          const color = bet.user_selected_color.toLowerCase();
          if (currentBettingStats.colors.hasOwnProperty(color)) {
            currentBettingStats.colors[color] += amount;
            currentBettingStats.colorCounts[color]++;
          }
        }
        
        // Size bets
        if (bet.bet_type === 'bigSmall' && bet.user_selected_bigSmall) {
          const size = bet.user_selected_bigSmall.toLowerCase();
          if (currentBettingStats.sizes.hasOwnProperty(size)) {
            currentBettingStats.sizes[size] += amount;
            currentBettingStats.sizeCounts[size]++;
          }
        }
      }
    }
    
    currentBettingStats.totalUsers = userCount;
    
    console.log("📊 Statistics calculated:", currentBettingStats);
  } catch (error) {
    console.error("❌ Error calculating betting statistics:", error);
  }
}

function updateStatisticsDisplay() {
  try {
    // Update total stats
    const totalUsersElement = document.getElementById('activeUsers');
    const totalBetsElement = document.getElementById('totalBets');
    const totalAmountElement = document.getElementById('totalAmount');
    
    if (totalUsersElement) totalUsersElement.textContent = currentBettingStats.totalUsers;
    if (totalBetsElement) totalBetsElement.textContent = currentBettingStats.totalBets;
    if (totalAmountElement) totalAmountElement.textContent = `₹${formatIndianNumber(currentBettingStats.totalAmount.toFixed(2))}`;
    
    // Update number stats
    for (let i = 0; i <= 9; i++) {
      const numberStatElement = document.querySelector(`[data-number="${i}"]`);
      if (numberStatElement) {
        const amountElement = numberStatElement.querySelector('.amount');
        const countElement = numberStatElement.querySelector('.count');
        
        if (amountElement) {
          amountElement.textContent = `₹${formatIndianNumber(currentBettingStats.numbers[i].toFixed(2))}`;
        }
        if (countElement) {
          countElement.textContent = `(${currentBettingStats.numberCounts[i]} bets)`;
        }
        
        // Highlight highest bet
        const isHighest = currentBettingStats.numbers[i] === Math.max(...Object.values(currentBettingStats.numbers));
        numberStatElement.style.background = isHighest && currentBettingStats.numbers[i] > 0 ? 
          'linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)' : 
          'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)';
        numberStatElement.style.color = isHighest && currentBettingStats.numbers[i] > 0 ? 'white' : '#333';
      }
    }
    
    // Update color stats
    ['red', 'green', 'violet'].forEach(color => {
      const colorStatElement = document.querySelector(`[data-color="${color}"]`);
      if (colorStatElement) {
        const amountElement = colorStatElement.querySelector('.amount');
        const countElement = colorStatElement.querySelector('.count');
        
        if (amountElement) {
          amountElement.textContent = `₹${formatIndianNumber(currentBettingStats.colors[color].toFixed(2))}`;
        }
        if (countElement) {
          countElement.textContent = `(${currentBettingStats.colorCounts[color]} bets)`;
        }
      }
    });
    
    // Update size stats
    ['big', 'small'].forEach(size => {
      const sizeStatElement = document.querySelector(`[data-size="${size}"]`);
      if (sizeStatElement) {
        const amountElement = sizeStatElement.querySelector('.amount');
        const countElement = sizeStatElement.querySelector('.count');
        
        if (amountElement) {
          amountElement.textContent = `₹${formatIndianNumber(currentBettingStats.sizes[size].toFixed(2))}`;
        }
        if (countElement) {
          countElement.textContent = `(${currentBettingStats.sizeCounts[size]} bets)`;
        }
      }
    });
    
  } catch (error) {
    console.error("❌ Error updating statistics display:", error);
  }
}

function resetStatistics() {
  try {
    currentBettingStats = {
      numbers: { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 },
      colors: { red: 0, green: 0, violet: 0 },
      sizes: { big: 0, small: 0 },
      totalUsers: 0,
      totalBets: 0,
      totalAmount: 0,
      numberCounts: { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0 },
      colorCounts: { red: 0, green: 0, violet: 0 },
      sizeCounts: { big: 0, small: 0 }
    };
    
    updateStatisticsDisplay();
  } catch (error) {
    console.error("❌ Error resetting statistics:", error);
  }
}

// ======== ADMIN RESULT OVERRIDE SYSTEM ========
async function setAdminResult() {
  try {
    console.log("👑 Setting admin result override...");
    
    const numberSelect = document.getElementById('adminNumber');
    const colorSelect = document.getElementById('adminColor');
    const sizeSelect = document.getElementById('adminSize');
    
    if (!numberSelect || !colorSelect || !sizeSelect) {
      showAdminToast("Admin controls not found", "error");
      return;
    }
    
    const selectedNumber = numberSelect.value;
    const selectedColor = colorSelect.value;
    const selectedSize = sizeSelect.value;
    
    // Validation
    if (!selectedNumber || !selectedColor || !selectedSize) {
      showAdminToast("Please select all values (number, color, size)", "error");
      return;
    }
    
    if (!currentPeriod) {
      showAdminToast("No active period found", "error");
      return;
    }
    
    // Create admin override object
    const adminOverride = {
      winning_number: parseInt(selectedNumber),
      winning_color: selectedColor,
      winning_bigSmall: selectedSize,
      admin_override: true,
      timestamp: new Date().toISOString(),
      period: currentPeriod
    };
    
    // Save to database
    await set(ref(db, `AdminOverrides/${currentPeriod}`), adminOverride);
    
    console.log("✅ Admin override set:", adminOverride);
    showAdminToast(`Result override set: ${selectedNumber} | ${capitalizeFirstLetter(selectedColor)} | ${capitalizeFirstLetter(selectedSize)}`, "success");
    
    // Update override status display
    updateOverrideStatus(adminOverride);
    
  } catch (error) {
    console.error("❌ Error setting admin result:", error);
    showAdminToast("Error setting admin override", "error");
  }
}

async function clearAdminResult() {
  try {
    console.log("🔄 Clearing admin result override...");
    
    if (!currentPeriod) {
      showAdminToast("No active period found", "error");
      return;
    }
    
    // Remove from database
    await set(ref(db, `AdminOverrides/${currentPeriod}`), null);
    
    console.log("✅ Admin override cleared");
    showAdminToast("Admin override cleared - using automatic generation", "success");
    
    // Reset form
    document.getElementById('adminNumber').value = '';
    document.getElementById('adminColor').value = '';
    document.getElementById('adminSize').value = '';
    
    // Update override status display
    updateOverrideStatus(null);
    
  } catch (error) {
    console.error("❌ Error clearing admin result:", error);
    showAdminToast("Error clearing admin override", "error");
  }
}

function checkAdminOverride() {
  try {
    if (!currentPeriod) return;
    
    const overrideRef = ref(db, `AdminOverrides/${currentPeriod}`);
    
    get(overrideRef).then(snapshot => {
      if (snapshot.exists()) {
        const override = snapshot.val();
        updateOverrideStatus(override);
        
        // Update form values
        document.getElementById('adminNumber').value = override.winning_number;
        document.getElementById('adminColor').value = override.winning_color;
        document.getElementById('adminSize').value = override.winning_bigSmall;
      } else {
        updateOverrideStatus(null);
      }
    }).catch(error => {
      console.error("❌ Error checking admin override:", error);
    });
  } catch (error) {
    console.error("❌ Error in checkAdminOverride:", error);
  }
}

function updateOverrideStatus(override) {
  try {
    const statusElement = document.getElementById('overrideStatus');
    if (!statusElement) return;
    
    if (override) {
      statusElement.innerHTML = `
        <span class="status-text" style="color: #e74c3c; font-weight: 900;">
          🚨 OVERRIDE ACTIVE: ${override.winning_number} | ${capitalizeFirstLetter(override.winning_color)} | ${capitalizeFirstLetter(override.winning_bigSmall)}
        </span>
      `;
      statusElement.style.background = 'rgba(231, 76, 60, 0.1)';
      statusElement.style.border = '2px solid #e74c3c';
    } else {
      statusElement.innerHTML = `
        <span class="status-text" style="color: #27ae60;">
          ✅ No override set - using automatic generation
        </span>
      `;
      statusElement.style.background = 'rgba(39, 174, 96, 0.1)';
      statusElement.style.border = '2px solid #27ae60';
    }
  } catch (error) {
    console.error("❌ Error updating override status:", error);
  }
}

// ======== ACTIVE USERS MONITORING ========
function updateActiveUsers(betsData) {
  try {
    const usersList = document.getElementById('usersList');
    if (!usersList) return;
    
    if (!betsData || Object.keys(betsData).length === 0) {
      usersList.innerHTML = '<div class="no-users">No active users</div>';
      return;
    }
    
    let usersHTML = '';
    
    for (const userId in betsData) {
      const userBets = betsData[userId];
      const betCount = Object.keys(userBets).length;
      let totalAmount = 0;
      
      for (const betId in userBets) {
        totalAmount += parseFloat(userBets[betId].user_total_amount) || 0;
      }
      
      const shortUserId = userId.length > 8 ? userId.substring(0, 8) + '...' : userId;
      
      usersHTML += `
        <div class="user-item">
          <div class="user-info">
            <div class="user-id">User: ${shortUserId}</div>
            <div class="user-activity">Active in current period</div>
          </div>
          <div class="user-bets">
            ${betCount} bets<br>
            ₹${formatIndianNumber(totalAmount.toFixed(2))}
          </div>
        </div>
      `;
    }
    
    usersList.innerHTML = usersHTML;
  } catch (error) {
    console.error("❌ Error updating active users:", error);
  }
}

// ======== RECENT RESULTS MONITORING ========
function setupResultsMonitoring() {
  try {
    console.log("📊 Setting up results monitoring...");
    
    const resultsRef = ref(db, 'Realtime_result_count');
    
    onValue(resultsRef, (snapshot) => {
      if (snapshot.exists()) {
        const resultsData = snapshot.val();
        updateRecentResults(resultsData);
      }
    }, (error) => {
      console.error("❌ Error monitoring results:", error);
    });
    
    console.log("✅ Results monitoring setup complete");
  } catch (error) {
    console.error("❌ Error setting up results monitoring:", error);
  }
}

function updateRecentResults(resultsData) {
  try {
    const resultsList = document.getElementById('recentResults');
    if (!resultsList) return;
    
    // Convert to array and sort by period (newest first)
    const results = Object.values(resultsData).sort((a, b) => {
      return parseInt(b.period) - parseInt(a.period);
    });
    
    if (results.length === 0) {
      resultsList.innerHTML = '<div class="no-results">No results yet</div>';
      return;
    }
    
    // Show last 10 results
    const recentResults = results.slice(0, 10);
    let resultsHTML = '';
    
    recentResults.forEach((result, index) => {
      const isLatest = index === 0;
      const displayPeriod = result.period.toString().slice(-8);
      
      resultsHTML += `
        <div class="result-item" style="${isLatest ? 'border-left-color: #ff6b35;' : ''}">
          <div class="result-period">
            ${isLatest ? '🔥 ' : ''}...${displayPeriod}
          </div>
          <div class="result-values">
            <div class="result-number">${result.winning_number}</div>
            <div class="result-color ${result.winning_color}">${capitalizeFirstLetter(result.winning_color)}</div>
            <div class="result-size">${capitalizeFirstLetter(result.winning_bigSmall)}</div>
          </div>
        </div>
      `;
    });
    
    resultsList.innerHTML = resultsHTML;
  } catch (error) {
    console.error("❌ Error updating recent results:", error);
  }
}

// ======== SYSTEM HEALTH MONITORING ========
function setupSystemHealthMonitoring() {
  try {
    console.log("🔧 Setting up system health monitoring...");
    
    const clientsRef = ref(db, 'gameSystem/activeClients');
    
    onValue(clientsRef, (snapshot) => {
      if (snapshot.exists()) {
        const clientsData = snapshot.val();
        updateSystemHealth(clientsData);
      } else {
        updateSystemHealth({});
      }
    }, (error) => {
      console.error("❌ Error monitoring system health:", error);
    });
    
    console.log("✅ System health monitoring setup complete");
  } catch (error) {
    console.error("❌ Error setting up system health monitoring:", error);
  }
}

function updateSystemHealth(clientsData) {
  try {
    const currentTime = Date.now();
    let activeClients = 0;
    let primaryClients = 0;
    
    for (const clientId in clientsData) {
      const client = clientsData[clientId];
      const lastSeen = new Date(client.lastSeen || client.timestamp).getTime();
      
      // Consider client active if seen within last 2 minutes
      if (currentTime - lastSeen < 120000) {
        activeClients++;
        
        if (client.role === 'primary') {
          primaryClients++;
        }
      }
    }
    
    systemHealth = {
      activeClients,
      primaryClients,
      status: activeClients > 0 ? (primaryClients > 0 ? 'healthy' : 'warning') : 'error'
    };
    
    // Update display
    const activeClientsElement = document.getElementById('activeClients');
    const primaryClientsElement = document.getElementById('primaryClients');
    const systemStatusElement = document.getElementById('systemStatus');
    
    if (activeClientsElement) activeClientsElement.textContent = systemHealth.activeClients;
    if (primaryClientsElement) primaryClientsElement.textContent = systemHealth.primaryClients;
    
    if (systemStatusElement) {
      let statusText = '';
      switch (systemHealth.status) {
        case 'healthy':
          statusText = '🟢 Healthy';
          break;
        case 'warning':
          statusText = '🟡 Warning';
          break;
        case 'error':
          statusText = '🔴 Error';
          break;
        default:
          statusText = '🟡 Checking...';
      }
      systemStatusElement.textContent = statusText;
    }
    
  } catch (error) {
    console.error("❌ Error updating system health:", error);
  }
}

// ======== CONNECTION STATUS ========
function updateConnectionStatus(connected) {
  try {
    connectionStatus = connected;
    const statusElement = document.getElementById('connectionStatus');
    
    if (statusElement) {
      if (connected) {
        statusElement.textContent = '🟢 Connected';
        statusElement.style.color = '#27ae60';
      } else {
        statusElement.textContent = '🔴 Disconnected';
        statusElement.style.color = '#e74c3c';
      }
    }
  } catch (error) {
    console.error("❌ Error updating connection status:", error);
  }
}

// ======== LOAD BETTING STATISTICS ========
function loadBettingStatistics() {
  try {
    if (!currentPeriod) return;
    
    console.log("📊 Loading betting statistics for period:", currentPeriod);
    
    const betsRef = ref(db, `CurrentGameBets/${currentPeriod}`);
    
    get(betsRef).then(snapshot => {
      if (snapshot.exists()) {
        const betsData = snapshot.val();
        calculateBettingStatistics(betsData);
        updateStatisticsDisplay();
        updateActiveUsers(betsData);
      } else {
        resetStatistics();
      }
    }).catch(error => {
      console.error("❌ Error loading betting statistics:", error);
    });
  } catch (error) {
    console.error("❌ Error in loadBettingStatistics:", error);
  }
}

// ======== INITIALIZATION ========
function initializeAdminPanel() {
  try {
    console.log("🚀 Initializing Admin Panel...");
    
    // Start real-time clock
    updateAdminClock();
    setInterval(updateAdminClock, 1000);
    
    // Setup all monitoring systems
    setupPeriodMonitoring();
    setupAdminTimer();
    setupBettingStatsMonitoring();
    setupResultsMonitoring();
    setupSystemHealthMonitoring();
    
    // Test connection
    const testRef = ref(db, '.info/connected');
    onValue(testRef, (snapshot) => {
      updateConnectionStatus(snapshot.val());
    });
    
    // Show success message
    setTimeout(() => {
      showAdminToast("🎮 Admin Panel Initialized Successfully!", "success");
    }, 1000);
    
    console.log("✅ Admin Panel fully initialized!");
    
  } catch (error) {
    console.error("❌ Error initializing admin panel:", error);
    showAdminToast("Failed to initialize admin panel", "error");
  }
}

// ======== EXPOSE FUNCTIONS TO WINDOW ========
window.setAdminResult = setAdminResult;
window.clearAdminResult = clearAdminResult;

// ======== START ADMIN PANEL ========
document.addEventListener('DOMContentLoaded', () => {
  console.log("🎛️ DOM loaded - starting admin panel...");
  initializeAdminPanel();
});

console.log("🛠️ Admin Panel JavaScript loaded successfully!");
        
        
    </script>





</body>
</html>